{% extends "base.html" %} {% block title %}I.B.U. MEMBER INFO{% endblock %} {%
block content %}

<div class="mx-auto w-full max-w-6xl px-4 py-6">
  <!-- Header -->
  <header class="rounded-2xl border border-white/10 bg-white/5 p-5 shadow-sm">
    <div
      class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between"
    >
      <div>
        <h1 class="text-xl font-semibold tracking-wide text-white">Members</h1>
        <p class="mt-1 text-sm text-white/70">
          Data from {{ time_ago }} ({{ latest_date }})
        </p>
      </div>
    </div>
  </header>

  <!-- Search -->
  <div class="mt-4">
    <input
      id="memberSearch"
      type="text"
      placeholder="Search members by name..."
      class="w-full rounded-xl border border-white/10 bg-white/5 py-3 px-4 text-sm text-white placeholder:text-white/40 outline-none focus:border-white/20 focus:bg-white/10"
    />
  </div>

  <!-- List -->
  <div
    class="mt-4 overflow-hidden rounded-xl backdrop-blur-2xl border border-white/10 bg-white/5"
  >
    <!-- Header row -->
    <div
      class="hidden grid-cols-12 gap-3 border-b border-white/10 px-4 py-3 text-xs font-semibold text-white/60 sm:grid"
    >
      <div class="col-span-3">Member</div>
      <div class="col-span-1">Days</div>
      <div class="col-span-2">Points</div>
      <div class="col-span-2">Status</div>
      <div class="col-span-4">Milestones</div>
    </div>

    <ul id="membersList" class="divide-y divide-x divide-white/10">
      {% for m in members %} {% set ps = m.probation_status %} {% set w =
      m.milestones.week_1 %} {% set m1 = m.milestones.month_1 %} {% set m3 =
      m.milestones.month_3 %}

      <li
        class="member-row px-4 py-3 hover:bg-white/5"
        data-name="{{ m.name | lower }}"
      >
        <div
          class="grid grid-cols-1 gap-2 sm:grid-cols-12 sm:items-center sm:gap-3"
        >
          <!-- Member -->
          <div class="sm:col-span-3">
            <div class="flex items-center gap-2">
              <div class="min-w-0">
                <div class="font-semibold text-white mb-1">
                  <a
                    class="shrink-0 rounded-4xl py-1 px-2 hover:bg-white/10"
                    href="/member/{{ m.name|urlencode }}"
                    title="Profile"
                  >
                    {{ m.name }}
                  </a>
                </div>
                <div class="px-2 text-xs text-white/50">
                  Joined {{ m.joined_date }}
                </div>
              </div>
            </div>
          </div>

          <!-- Days -->
          <div class="sm:col-span-1 sm:text-left">
            <div class="text-xs text-white/50 sm:hidden">Days</div>
            <div class="text-sm text-white">{{ m.days_since_joined }}</div>
          </div>

          <!-- Points -->
          <div class="sm:col-span-2 sm:text-left">
            <div class="text-xs text-white/50 sm:hidden">Points</div>
            <div class="text-sm text-white">
              {{ "{:,}".format(m.current_points) }}
            </div>
          </div>

          <!-- Status -->
          <div class="sm:col-span-2">
            <div class="text-xs text-white/50 sm:hidden">Status</div>
            <span
              class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium {% if ps in ['passed','completed'] %} bg-green-500/15 text-green-300 {% elif ps == 'failed' %} border-rose-400/25 bg-rose-400/15 text-rose-100 {% else %} border-amber-400/25 bg-amber-400/15 text-amber-100 {% endif %}"
            >
              {% if ps == 'in_progress' %}In Progress {% elif ps == 'passed'
              %}Passed {% elif ps == 'completed' %}Completed {% elif ps ==
              'failed' %}Failed {% else %}{{ ps }}{% endif %}
            </span>

            {% if ps == 'passed' and m.post_probation_status %}
            <span
              class="ml-2 inline-flex items-center rounded-full border border-white/10 bg-white/10 px-2.5 py-1 text-[11px] text-white/80"
            >
              N/A
            </span>
            {% endif %}
          </div>

          <!-- Milestones -->
          <div class="sm:col-span-4">
            <div class="text-xs text-white/50 sm:hidden">Milestones</div>

            <div class="grid grid-cols-3 gap-2">
              {% macro milestone_cell(label, ms) %}
              <div class="relative group">
                <!-- Pill -->
                <div
                  class="inline-flex items-center rounded-full px-2.5 py-1 text-xs font-medium {% if ms.passed is sameas(true) %}bg-green-500/15 {% elif ms.passed is sameas(false) %}bg-red-500/15 {% else %}bg-amber-200/15{% endif %}"
                >
                  <div
                    class="text-[11px] font-semibold {% if ms.passed is sameas(true) %}text-green-300 {% elif ms.passed is sameas(false) %}text-rose-200 {% else %}text-amber-200{% endif %}"
                  >
                    {{ label }}
                  </div>
                </div>
                <!-- More detailed overview -->
                <div
                  class="pointer-events-none absolute left-0 top-full z-50 mt-2 w-56 opacity-0 transition duration-150 ease-out group-hover:opacity-100"
                >
                  <div
                    class="rounded-xl border border-white/15 bg-gray-950/80 p-3 shadow-xl backdrop-blur"
                  >
                    <div class="flex items-center justify-between">
                      <div class="text-xs font-semibold text-white">
                        {{ label }}
                      </div>
                      <div
                        class="text-[11px] {% if ms.passed is sameas(true) %}text-green-300 {% elif ms.passed is sameas(false) %}text-rose-200 {% else %}text-amber-200{% endif %}"
                      >
                        {% if ms.passed is sameas(true) %}Passed {% elif
                        ms.passed is sameas(false) %}Failed {% else %}Pending{%
                        endif %}
                      </div>
                    </div>

                    <div class="mt-1 text-[11px] text-white/80">
                      Points at deadline:
                      <span class="text-white">
                        {{ "{:,}".format((ms.points_at_deadline if
                        ms.points_at_deadline is not none else
                        m.current_points)) }}
                      </span>
                    </div>

                    <div class="mt-2 text-[11px] text-white/80">
                      Target:
                      <span class="text-white"
                        >{{ "{:,}".format(ms.target) }}</span
                      >
                    </div>

                    {% if ms.passed is none and ms.days_left is not none %}
                    <div
                      class="mt-2 rounded-lg border border-white/10 bg-white/5 px-2 py-2"
                    >
                      <div class="text-[11px] text-white/70">
                        {% if ms.days_left > 0 %} {{
                        "{:,}".format(ms.remaining_points) }} needed in {{
                        ms.days_left }} day{{ 's' if ms.days_left != 1 else ''
                        }} {% elif ms.days_left == 0 %} Due today: {{
                        "{:,}".format(ms.remaining_points) }} {% endif %}
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% endmacro %} {{ milestone_cell('Week', w) }} {{
              milestone_cell('Month 1', m1) }} {{ milestone_cell('Month 3', m3)
              }}
            </div>
          </div>
        </div>
      </li>
      {% endfor %} {% if members|length == 0 %}
      <li class="px-4 py-10 text-center text-sm text-white/70">
        No member data available.
      </li>
      {% endif %}
    </ul>
  </div>
</div>

<script>
  const input = document.getElementById("memberSearch");
  const rows = document.querySelectorAll(".member-row");
  input?.addEventListener("input", () => {
    const q = input.value.toLowerCase().trim();
    rows.forEach((r) => {
      const name = r.getAttribute("data-name") || "";
      r.style.display = name.includes(q) ? "" : "none";
    });
  });
</script>

{% endblock %}
